"""
app.py - ê°€ê³„ë¶€ ë¶„ì„ê¸° ë©”ì¸ ì•± (ë‚´ë¹„ê²Œì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬)
=====================================================
ì´ íŒŒì¼ì€ Streamlit ì•±ì˜ ì§„ì…ì (Entry Point)ì…ë‹ˆë‹¤.
ì‹¤í–‰ ë°©ë²•: streamlit run app.py

- st.navigation()ì„ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ë¥¼ ì¡°ê±´ë¶€ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
- ê´€ë¦¬ì í˜ì´ì§€ëŠ” admin ì—­í• ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œëŠ” ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.
"""

import streamlit as st

# ë¡œì»¬ ëª¨ë“ˆ ì„í¬íŠ¸
import db
import auth

# ============================================================
# ì•± ê¸°ë³¸ ì„¤ì • (ìµœì´ˆ 1íšŒë§Œ í˜¸ì¶œ)
# ============================================================
st.set_page_config(
    page_title="ğŸ’° ê°€ê³„ë¶€ ë¶„ì„ê¸°",
    page_icon="ğŸ’°",
    layout="wide",
    initial_sidebar_state="expanded",
)

# ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” (í…Œì´ë¸” ìƒì„± + ê´€ë¦¬ì ì‹œë“œ)
db.init_db()

# ============================================================
# ë‚´ë¹„ê²Œì´ì…˜ êµ¬ì„± (í•­ìƒ st.navigation() í˜¸ì¶œí•˜ì—¬ auto-discovery ë¹„í™œì„±í™”)
# ============================================================
if auth.is_logged_in():
    # â”€â”€ ë¡œê·¸ì¸ ë¨: ì‚¬ì´ë“œë°” ì •ë³´ + ì—­í•  ê¸°ë°˜ ë©”ë‰´ â”€â”€
    st.sidebar.title("ğŸ’° ê°€ê³„ë¶€ ë¶„ì„ê¸°")
    auth.show_user_info()

    main_pages = [
        st.Page("pages/0_ğŸ _ëŒ€ì‹œë³´ë“œ.py", title="ëŒ€ì‹œë³´ë“œ", icon="ğŸ ", default=True),
        st.Page("pages/1_ğŸ“_ì…ë ¥.py", title="ê±°ë˜ ì…ë ¥", icon="ğŸ“"),
        st.Page("pages/2_ğŸ“‹_ë‚´ì—­.py", title="ê±°ë˜ ë‚´ì—­", icon="ğŸ“‹"),
        st.Page("pages/3_ğŸ“Š_ë¶„ì„.py", title="ì†Œë¹„ ë¶„ì„", icon="ğŸ“Š"),
        st.Page("pages/4_âš™ï¸_ì„¤ì •.py", title="ì„¤ì •", icon="âš™ï¸"),
    ]

    nav_config = {"ë©”ë‰´": main_pages}

    if auth.get_role() == "admin":
        nav_config["ê´€ë¦¬"] = [
            st.Page("pages/5_ğŸ”§_ê´€ë¦¬ì.py", title="ê´€ë¦¬ì íŒ¨ë„", icon="ğŸ”§"),
        ]

    pg = st.navigation(nav_config)
else:
    # â”€â”€ ë¯¸ë¡œê·¸ì¸: ë¡œê·¸ì¸ í˜ì´ì§€ë§Œ í‘œì‹œ â”€â”€
    pg = st.navigation([st.Page(auth._show_auth_ui, title="ë¡œê·¸ì¸", icon="ğŸ”‘")])

pg.run()
